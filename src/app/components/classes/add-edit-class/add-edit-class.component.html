<div class="card add-edit-class-container">

    <h2 class="card-header">
        {{ isEditMode ? 'Edit Class: ' + classForm.get('code')?.value : 'Create New Class' }}
    </h2>

    <div class="card-body">
        <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

        <div *ngIf="loading && isEditMode" class="text-center p-5">
            <span class="spinner-border spinner-border-lg"></span>
        </div>

        <form [formGroup]="classForm" (ngSubmit)="onSubmit()" *ngIf="!loading || !isEditMode">

            <div class="form-group">
                <label for="name">Class Name</label>
                <input
                    type="text"
                    formControlName="name"
                    class="form-control"
                    [ngClass]="{ 'is-invalid': submitted && f['name'].errors }"
                />
                <div *ngIf="submitted && f['name'].errors" class="invalid-feedback">
                    <div *ngIf="f['name'].errors['required']">Class Name is required</div>
                    <div *ngIf="f['name'].errors['maxlength']">Name cannot exceed 100 characters</div>
                </div>
            </div>

            <div class="form-group">
                <label for="code">Course Code</label>
                <input
                    type="text"
                    formControlName="code"
                    class="form-control"
                    [ngClass]="{ 'is-invalid': submitted && f['code'].errors }"
                    placeholder="e.g., MATH101"
                />
                <div *ngIf="submitted && f['code'].errors" class="invalid-feedback">
                    <div *ngIf="f['code'].errors['required']">Course Code is required</div>
                    <div *ngIf="f['code'].errors['pattern']">Code must be 3-10 uppercase letters or numbers</div>
                </div>
            </div>

            <div class="form-group">
                <label for="teacherId">Assigned Teacher ID</label>
                <input
                    type="text"
                    formControlName="teacherId"
                    class="form-control"
                    [ngClass]="{ 'is-invalid': submitted && f['teacherId'].errors }"
                    placeholder="Enter Teacher User ID"
                />
                <div *ngIf="submitted && f['teacherId'].errors" class="invalid-feedback">
                    <div *ngIf="f['teacherId'].errors['required']">Teacher assignment is required</div>
                </div>
            </div>

            <div class="form-group">
                <label for="description">Description (Optional)</label>
                <textarea
                    formControlName="description"
                    class="form-control"
                    rows="3"
                    [ngClass]="{ 'is-invalid': submitted && f['description'].errors }"
                ></textarea>
                 <div *ngIf="submitted && f['description'].errors" class="invalid-feedback">
                    <div *ngIf="f['description'].errors['maxlength']">Description cannot exceed 500 characters</div>
                </div>
            </div>

            <div class="form-group action-buttons mt-4">
                <button [disabled]="loading" class="btn btn-primary mr-2">
                    <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
                    {{ isEditMode ? 'Update Class' : 'Create Class' }}
                </button>
                <button type="button" [routerLink]="['/classes']" class="btn btn-secondary">
                    Cancel
                </button>
            </div>
        </form>
    </div>
</div>
