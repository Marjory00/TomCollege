<div class="container mt-4">
    <div class="card shadow">
        <div class="card-header bg-primary text-white">
            <h1 class="h4 mb-0">
                <i class="fas fa-book-open me-2"></i>
                @if (isEditMode) {
                    Edit Class Details
                } @else {
                    Add New Class
                }
            </h1>
        </div>
        <div class="card-body">

            @if (loading) {
                <div class="text-center py-5">
                    <div class="spinner-border text-primary" role="status"></div>
                    <p class="mt-2">Loading class data...</p>
                </div>
            }

            @if (errorMessage && !loading) {
                <div class="alert alert-danger" role="alert">
                    {{ errorMessage }}
                </div>
            }

            @if (!loading) {
                <form [formGroup]="classForm" (ngSubmit)="onSubmit()">

                    <div class="row">
                        <div class="col-md-7 mb-3">
                            <label for="name" class="form-label">Class Name</label>
                            <input type="text" id="name" formControlName="name" class="form-control"
                                placeholder="e.g., Introduction to Web Development"
                                [class.is-invalid]="classForm.get('name')?.invalid && classForm.get('name')?.touched">
                            @if (classForm.get('name')?.hasError('required') && classForm.get('name')?.touched) {
                                <div class="invalid-feedback">Class Name is required.</div>
                            }
                        </div>

                        <div class="col-md-5 mb-3">
                            <label for="courseCode" class="form-label">Course Code</label>
                            <input type="text" id="courseCode" formControlName="courseCode" class="form-control"
                                placeholder="e.g., CS101"
                                [class.is-invalid]="classForm.get('courseCode')?.invalid && classForm.get('courseCode')?.touched">
                            @if (classForm.get('courseCode')?.hasError('required') && classForm.get('courseCode')?.touched) {
                                <div class="invalid-feedback">Course Code is required.</div>
                            } @else if (classForm.get('courseCode')?.hasError('pattern') && classForm.get('courseCode')?.touched) {
                                <div class="invalid-feedback">Must be a valid code (e.g., MATH201).</div>
                            }
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="creditHours" class="form-label">Credit Hours</label>
                            <input type="number" id="creditHours" formControlName="creditHours" class="form-control"
                                [class.is-invalid]="classForm.get('creditHours')?.invalid && classForm.get('creditHours')?.touched">
                            @if (classForm.get('creditHours')?.hasError('required') && classForm.get('creditHours')?.touched) {
                                <div class="invalid-feedback">Credit Hours is required.</div>
                            } @else if (classForm.get('creditHours')?.hasError('min') || classForm.get('creditHours')?.hasError('max')) {
                                <div class="invalid-feedback">Must be between 1 and 6 hours.</div>
                            }
                        </div>

                        <div class="col-md-6 mb-3">
                            <label for="department" class="form-label">Department</label>
                            <select id="department" formControlName="department" class="form-select"
                                [class.is-invalid]="classForm.get('department')?.invalid && classForm.get('department')?.touched">
                                <option value="" disabled>Select Department</option>
                                @for (dept of departments; track dept) {
                                    <option [value]="dept">{{ dept }}</option>
                                }
                            </select>
                            @if (classForm.get('department')?.hasError('required') && classForm.get('department')?.touched) {
                                <div class="invalid-feedback">Department is required.</div>
                            }
                        </div>
                    </div>

                    <div class="mb-4">
                        <label for="description" class="form-label">Description (Optional)</label>
                        <textarea id="description" formControlName="description" class="form-control" rows="3"
                            [class.is-invalid]="classForm.get('description')?.invalid && classForm.get('description')?.touched"></textarea>
                         @if (classForm.get('description')?.hasError('maxlength') && classForm.get('description')?.touched) {
                                <div class="invalid-feedback">Description is too long (max 500 characters).</div>
                            }
                    </div>

                    <div class="d-flex justify-content-end pt-3 border-top">
                        <button type="button" class="btn btn-secondary me-2" (click)="cancel()">
                            <i class="fas fa-times me-2"></i>Cancel
                        </button>
                        <button type="submit" class="btn btn-primary" [disabled]="submitting || classForm.invalid">
                            @if (submitting) {
                                <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                                Saving...
                            } @else {
                                <i class="fas fa-save me-2"></i>
                                {{ isEditMode ? 'Update Class' : 'Create Class' }}
                            }
                        </button>
                    </div>

                </form>
            }
        </div>
    </div>
</div>
